This topic explains how to monitor the health of the Pivotal Cloud Foundry (PCF) Metrics service using the logs, metrics, and Key Performance Indicators (KPIs) emitted by Cloud Foundry and the Metrics app itself.

## <a id="kpi"></a>Key Performance Indicators

Key Performance Indicators (KPIs) for PCF Metrics are metrics that operators find most useful for monitoring their PCF Metrics service to ensure smooth operation. KPIs are high-signal-value metrics that can indicate emerging issues.

Pivotal provides the following KPIs as general alerting and response guidance for typical PCF Metrics installations.
Pivotal recommends that operators continue to fine-tune the alert measures to their installation by observing historical trends.
Pivotal also recommends that operators expand beyond this guidance and create new, installation-specific monitoring
metrics, thresholds, and alerts based on learning from their own installations.

#### <a id="bosh-metrics"></a> BOSH Metrics

All BOSH-deployed components generate the following metrics. Monitor them to ensure that they are not consuming excess resources.

<table>
   <tr><th colspan="3" style="text-align: center;"><br> BOSH Metrics<br><br></th></tr>
   <tr>
      <th width="25%">Metrics</th>

    <td>
      Name: Memory percentage<br><br>
      Description: Percentage used of the VM Memory
    </td>

    <td>
      Name: Persistent disk percentage<br><br>
      Description: Percentage used of the VM persistent disk
    </td>
   </tr>

   <tr>
      <th>VMs</th>
      <td colspan="2">MySQL, Redis, ElasticSearch data, ElasticSearch master</td>
   </tr>

   <tr>
      <th>Recommended alert thresholds</th>
      <td colspan="2">&gt; 80%</td>
   </tr>

   <tr>
      <th>Recommended response</th>
      <td colspan="2">Scale up as appropriate</td>
   </tr>
</table>




#### <a id="system-metrics"></a> System Metrics

All apps pushed using Cloud Foundry automatically emit the following app system metrics. PCF Metrics is a collection of apps like any other CF apps, and thus can be monitored by PCF Metrics (among other monitoring services). The following KPIs can indicate problems with your installation.

<table>
   <tr><th colspan="3" style="text-align: center;"><br> System Metrics<br><br></th></tr>
   <tr>
      <th width="25%">Metrics</th>

    <td>
      Name: Memory percentage<br><br>
      Description: Percentage used of the app container Memory
    </td>

    <td>
      Name: Persistent disk percentage<br><br>
      Description: Percentage used of the app container persistent disk
    </td>
   </tr>

   <tr>
      <th>App</th>
      <td colspan="2">PCF Metrics apps (metrics-ingestor, mysql-logqueue, elasticsearch-logqueue, metrics, metrics-ui)</td>
   </tr>

   <tr>
      <th>Recommended alert thresholds</th>
      <td colspan="2">&gt; 80%</td>
   </tr>

   <tr>
      <th>Recommended response</th>
      <td colspan="2">Scale up as appropriate</td>
   </tr>
</table>






#### <a id="custom-metrics"></a> Custom Metrics

All PCF Metrics apps are already set up to emit certain custom metrics to indicate app health. As long as you make the appropriate configurations to export these metrics, they can be monitored by PCF Metrics (among other monitoring services). The following KPIs can indicate problems with your installation.
Please refer to the <a href="https://docs.pivotal.io/metrics-forwarder/index.html">Metrics Forwarder documentation</a> for more information about how to set up custom metrics with the Metrics Forwarder.

<table>
   <tr><th colspan="3" style="text-align: center;"><br> Custom Metrics<br><br></th></tr>
   <tr>
      <th width="25%">Metrics</th>

    <td>
      Name: metric_processor.envelopes_stored.rate.1_minute<br><br>
      Description: The rate at which metrics processor stores metric envelopes to its persistent data store
    </td>

    <td>
      Name: log_processor.envelopes_stored.rate.1_minute<br><br>
      Description: The rate at which log processor stores log envelopes to its persistent data store
    </td>
   </tr>

    <tr>
       <th>App</th>
       <td>mysql-logsqueue</td>
       <td>elasticsearch-logsqueue</td>
    </tr>

    <tr>
       <th>Recommended alert thresholds</th>
       <td colspan="2">Below 0 at all times for the past 30 mins</td>
    </tr>

   <tr>
      <th>Recommended response</th>
      <td colspan="2">Consult the <a href="http://docs.pivotal.io/pcf-metrics/troubleshooting.html">troubleshooting document</a> for further guidance.</td>
   </tr>
</table>

If you have any further questions regarding monitoring PCF Metrics, refer to the <a href="http://docs.pivotal.io/pcf-metrics/troubleshooting.html">PCF Metrics troubleshooting guide.</a>
